<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Organisms</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 50%, #0f0f1a 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 24px;
            gap: 20px;
        }
        header {
            text-align: center;
            padding: 20px 0;
        }
        h1 {
            font-size: 28px;
            font-weight: 600;
            background: linear-gradient(135deg, #c9a7eb 0%, #8b5cf6 50%, #6366f1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }
        .subtitle {
            font-size: 14px;
            color: #9ca3af;
        }
        #canvas-container {
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5),
                        0 0 0 1px rgba(139, 92, 246, 0.1);
        }
        .controls {
            background: rgba(26, 26, 46, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px 24px;
            width: 100%;
            max-width: 600px;
            border: 1px solid rgba(139, 92, 246, 0.15);
        }
        .control-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .control-row:last-child {
            border-bottom: none;
        }
        .control-label {
            font-size: 14px;
            font-weight: 500;
        }
        .control-value {
            font-size: 13px;
            color: #9ca3af;
            min-width: 50px;
            text-align: right;
        }
        input[type="range"] {
            -webkit-appearance: none;
            width: 180px;
            height: 6px;
            background: rgba(139, 92, 246, 0.2);
            border-radius: 3px;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.4);
            transition: transform 0.2s;
        }
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }
        .btn-row {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }
        button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.3);
        }
        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: #e0e0e0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .stats {
            display: flex;
            gap: 24px;
            font-size: 12px;
            color: #6b7280;
            margin-top: 8px;
        }
        .stat {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .stat-value {
            color: #8b5cf6;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Digital Organisms</h1>
            <p class="subtitle">Self-replicating patterns evolving through simulated mutation</p>
        </header>
        <div id="canvas-container"></div>
        <div class="controls">
            <div class="control-row">
                <span class="control-label">Initial Cells</span>
                <input type="range" id="initialCells" min="1" max="20" value="5">
                <span class="control-value" id="initialCellsVal">5</span>
            </div>
            <div class="control-row">
                <span class="control-label">Division Rate</span>
                <input type="range" id="divisionRate" min="1" max="100" value="15">
                <span class="control-value" id="divisionRateVal">15%</span>
            </div>
            <div class="control-row">
                <span class="control-label">Mutation Rate</span>
                <input type="range" id="mutationRate" min="1" max="50" value="10">
                <span class="control-value" id="mutationRateVal">10%</span>
            </div>
            <div class="control-row">
                <span class="control-label">Cell Size</span>
                <input type="range" id="cellSize" min="4" max="20" value="8">
                <span class="control-value" id="cellSizeVal">8</span>
            </div>
            <div class="control-row">
                <span class="control-label">Color Shift</span>
                <input type="range" id="colorShift" min="0" max="360" value="45">
                <span class="control-value" id="colorShiftVal">45°</span>
            </div>
            <div class="btn-row">
                <button class="btn-primary" onclick="resetSimulation()">Reset</button>
                <button class="btn-secondary" onclick="pauseToggle()">Pause</button>
            </div>
            <div class="stats">
                <div class="stat">Generation: <span class="stat-value" id="generation">0</span></div>
                <div class="stat">Cells: <span class="stat-value" id="cellCount">0</span></div>
                <div class="stat">Mutations: <span class="stat-value" id="mutations">0</span></div>
            </div>
        </div>
    </div>
    <script>
        // ═══════════════════════════════════════════════════════════════════════════
        //  PARAMETERS - All tunable values in one place
        // ═══════════════════════════════════════════════════════════════════════════
        let params = {
            initialCells: 5,
            divisionRate: 0.015,
            mutationRate: 0.10,
            cellSize: 8,
            colorShift: 45,
            seed: 1847
        };

        // ═══════════════════════════════════════════════════════════════════════════
        //  STATE - Runtime variables
        // ═══════════════════════════════════════════════════════════════════════════
        let cells = [];
        let generation = 0;
        let mutationCount = 0;
        let paused = false;
        let baseHue;

        // ═══════════════════════════════════════════════════════════════════════════
        //  CELL CLASS - The fundamental building block
        // ═══════════════════════════════════════════════════════════════════════════
        class Cell {
            constructor(x, y, hue, generation = 0) {
                this.x = x;
                this.y = y;
                this.hue = hue;
                this.generation = generation;
                this.age = 0;
                this.size = params.cellSize;
                this.energy = random(0.5, 1.0);
                this.mutation = random(-0.1, 0.1);
            }

            update() {
                this.age++;

                // Chance to divide
                if (this.energy > 0.3 && random() < params.divisionRate) {
                    this.energy *= 0.5;
                    return this.divide();
                }

                // Energy decay
                this.energy *= 0.995;

                // Slight movement (organic wobble)
                this.x += random(-0.5, 0.5);
                this.y += random(-0.5, 0.5);

                return null;
            }

            divide() {
                let newHue = this.hue + this.mutation;

                // Mutation on division
                if (random() < params.mutationRate) {
                    newHue += random(-15, 15);
                    mutationCount++;
                }

                // Keep hue in range
                newHue = ((newHue % 360) + 360) % 360;

                let offsetX = random(-this.size, this.size);
                let offsetY = random(-this.size, this.size);

                let child = new Cell(
                    this.x + offsetX,
                    this.y + offsetY,
                    newHue,
                    this.generation + 1
                );

                child.size = this.size * (0.9 + random(-0.1, 0.1));
                child.mutation = this.mutation + random(-0.05, 0.05);

                return child;
            }

            draw() {
                let alpha = map(this.energy, 0, 1, 50, 255);
                let saturation = map(this.generation, 0, 50, 80, 100);
                let brightness = map(this.generation, 0, 50, 90, 70);

                colorMode(HSB, 360, 100, 100, 255);
                fill(this.hue, saturation, brightness, alpha);
                noStroke();

                // Organic shape - slightly irregular circle
                push();
                translate(this.x, this.y);
                beginShape();
                for (let a = 0; a < TWO_PI; a += PI / 6) {
                    let r = this.size * (0.8 + random(-0.1, 0.1));
                    let px = cos(a) * r;
                    let py = sin(a) * r;
                    vertex(px, py);
                }
                endShape(CLOSE);

                // Inner glow
                fill(this.hue, 50, 100, alpha * 0.3);
                ellipse(0, 0, this.size * 0.5);
                pop();
            }

            isDead() {
                return this.energy <= 0;
            }

            overlaps(other) {
                let d = dist(this.x, this.y, other.x, other.y);
                return d < (this.size + other.size) * 0.8;
            }
        }

        // ═══════════════════════════════════════════════════════════════════════════
        //  P5.JS LIFECYCLE FUNCTIONS
        // ═══════════════════════════════════════════════════════════════════════════
        function setup() {
            let canvas = createCanvas(600, 500);
            canvas.parent('canvas-container');

            randomSeed(params.seed);
            noiseSeed(params.seed);

            baseHue = random(280, 320); // Purple range

            initializeSystem();
        }

        function initializeSystem() {
            cells = [];
            generation = 0;
            mutationCount = 0;

            // Create initial cells at center
            for (let i = 0; i < params.initialCells; i++) {
                let angle = map(i, 0, params.initialCells, 0, TWO_PI);
                let radius = random(20, 60);
                let x = width / 2 + cos(angle) * radius;
                let y = height / 2 + sin(angle) * radius;

                cells.push(new Cell(x, y, baseHue + random(-20, 20)));
            }
        }

        function draw() {
            // Semi-transparent background for trail effect
            colorMode(RGB);
            background(10, 10, 20, 25);

            if (!paused) {
                updateSimulation();
            }

            // Draw all cells
            for (let cell of cells) {
                if (paused) {
                    cell.draw();
                } else {
                    cell.draw();
                }
            }

            updateStats();
        }

        function updateSimulation() {
            let newCells = [];

            for (let cell of cells) {
                let child = cell.update();
                if (child) {
                    newCells.push(child);
                }
            }

            // Add new cells
            cells.push(...newCells);

            // Remove dead cells
            cells = cells.filter(c => !c.isDead());

            // Soft collision - push overlapping cells apart
            for (let i = 0; i < cells.length; i++) {
                for (let j = i + 1; j < cells.length; j++) {
                    if (cells[i].overlaps(cells[j])) {
                        let dx = cells[j].x - cells[i].x;
                        let dy = cells[j].y - cells[i].y;
                        let d = sqrt(dx * dx + dy * dy);
                        if (d > 0) {
                            let force = 0.5;
                            cells[i].x -= (dx / d) * force;
                            cells[i].y -= (dy / d) * force;
                            cells[j].x += (dx / d) * force;
                            cells[j].y += (dy / d) * force;
                        }
                    }
                }
            }

            // Boundary containment
            for (let cell of cells) {
                cell.x = constrain(cell.x, cell.size, width - cell.size);
                cell.y = constrain(cell.y, cell.size, height - cell.size);
            }

            // Update max generation
            for (let cell of cells) {
                if (cell.generation > generation) {
                    generation = cell.generation;
                }
            }

            // Limit total cells for performance
            if (cells.length > 800) {
                cells = cells.slice(-800);
            }
        }

        function updateStats() {
            document.getElementById('generation').textContent = generation;
            document.getElementById('cellCount').textContent = cells.length;
            document.getElementById('mutations').textContent = mutationCount;
        }

        // ═══════════════════════════════════════════════════════════════════════════
        //  UI CONTROL HANDLERS
        // ═══════════════════════════════════════════════════════════════════════════
        function resetSimulation() {
            randomSeed(params.seed);
            initializeSystem();
        }

        function pauseToggle() {
            paused = !paused;
            document.querySelector('.btn-secondary').textContent = paused ? 'Resume' : 'Pause';
        }

        // Slider event listeners
        document.getElementById('initialCells').addEventListener('input', function() {
            params.initialCells = parseInt(this.value);
            document.getElementById('initialCellsVal').textContent = this.value;
        });

        document.getElementById('divisionRate').addEventListener('input', function() {
            params.divisionRate = parseInt(this.value) / 1000;
            document.getElementById('divisionRateVal').textContent = this.value + '%';
        });

        document.getElementById('mutationRate').addEventListener('input', function() {
            params.mutationRate = parseInt(this.value) / 100;
            document.getElementById('mutationRateVal').textContent = this.value + '%';
        });

        document.getElementById('cellSize').addEventListener('input', function() {
            params.cellSize = parseInt(this.value);
            document.getElementById('cellSizeVal').textContent = this.value;
        });

        document.getElementById('colorShift').addEventListener('input', function() {
            params.colorShift = parseInt(this.value);
            document.getElementById('colorShiftVal').textContent = this.value + '°';
        });
    </script>
</body>
</html>