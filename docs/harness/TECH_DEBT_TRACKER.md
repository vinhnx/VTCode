# Tech Debt Tracker

Known technical debt items with priority and ownership. Review this document on a regular cadence (suggested: bi-weekly).

## Priority Levels

- **P0**: Blocks new feature work or causes user-visible issues. Fix immediately.
- **P1**: Significant quality or maintainability impact. Fix within current cycle.
- **P2**: Moderate impact. Schedule for next cycle.
- **P3**: Minor impact. Track but tolerate. Fix opportunistically.

## Status Values

- **open**: identified, not yet started
- **in-progress**: actively being worked on (link to exec plan if applicable)
- **resolved**: fixed, awaiting verification or merged
- **wont-fix**: accepted as-is with documented rationale

---

## Debt Items

| ID     | Area           | Description | Priority | Status | Last Reviewed | Notes |
|--------|----------------|-------------|----------|--------|---------------|-------|
| TD-001 | Documentation  | Documentation sprawl: 668+ files in `docs/`, many stale or redundant. See `QUALITY_SCORE.md` Documentation domain (grade C). | P1 | in-progress | 2026-02-15 | Meta-docs (AGENTS.md, CONTRIBUTING.md) added. Started consolidation with `docs/LANGUAGE_SUPPORT.md`. |
| TD-002 | Codebase       | Duplicated logic across workspace crates. Common patterns reimplemented instead of shared via `vtcode-commons`. | P2 | in-progress | 2026-02-15 | Extracted shared workspace-boundary helper (`ensure_path_within_workspace`) into `vtcode-commons` and migrated `shell`/`pty` call sites in `vtcode-core`. Continued migration in ACP by replacing local workspace-boundary checks in `src/acp/zed/agent/tool_config.rs` (`resolve_terminal_working_dir`, `resolve_workspace_path`) and `src/acp/zed/agent/tool_execution_local.rs` (`resolve_list_files_path`) with the shared helper via `vtcode_core::utils::path`. Replaced manual benchmark context-file canonicalization/boundary checks in `src/cli/benchmark.rs` and manual `edit_file` path canonicalization/boundary checks in `vtcode-core/src/tools/registry/file_helpers.rs` with shared `resolve_workspace_path`; additionally switched benchmark spec/context reads and report writes to shared `vtcode_core::utils::file_utils` helpers. Replaced startup provider label/API-key-env mapping duplication in `src/startup/helpers.rs` with `Provider::label()` and `Provider::default_api_key_env()`, and reused shared `canonicalize_workspace` in startup workspace-path resolution. Simplified duplicate provider->env inference logic in `vtcode-config/src/api_keys.rs` by reusing `Provider::default_api_key_env()`, collapsing `ApiKeySources::for_provider()` to the default mapping, and consolidating duplicated optional-provider fallback logic (`ollama`/`lmstudio`) into a shared helper. Also replaced ad-hoc async `.env` read/parent-directory creation in `src/agent/runloop/unified/model_selection.rs` (`persist_env_value`) with shared `vtcode_core::utils::file_utils` helpers (`read_file_with_context`, `ensure_dir_exists`). Replaced local /share-log export writes in `src/agent/runloop/unified/turn/session/slash_commands/share_log.rs` with shared `write_file_with_context_sync`. Replaced updater cache-directory creation/update-check timestamp writes in `src/updater.rs` and man-page output writes in `src/cli/man.rs` with shared sync `vtcode_core::utils::file_utils` helpers (`ensure_dir_exists_sync`, `write_file_with_context_sync`). Replaced harness event-emitter parent-directory creation in `src/agent/runloop/unified/inline_events/harness.rs` with shared `ensure_dir_exists_sync`. Replaced large-output spool read/dir-create logic in `src/agent/runloop/tool_output/large_output.rs` with shared sync helpers (`read_file_with_context_sync`, `ensure_dir_exists_sync`). Replaced ripgrep installer lock/cache directory creation and installation-cache file reads/writes in `src/tools/ripgrep_installer.rs` with shared sync helpers (`ensure_dir_exists_sync`, `read_file_with_context_sync`, `write_file_with_context_sync`). Replaced first-run workspace `.vtcode` directory creation in `src/startup/first_run.rs` with shared `ensure_dir_exists_sync`. Replaced dynamic model cache persistence in `src/agent/runloop/model_picker/dynamic_models.rs` with shared async `write_file_with_context` helper. Replaced workspace linked-directory root creation in `src/agent/runloop/unified/workspace_links.rs` with shared async `ensure_dir_exists`. Replaced `/skills create` directory/template writes in `src/cli/skills.rs` with shared sync helpers (`ensure_dir_exists_sync`, `write_file_with_context_sync`). Replaced legacy tool-output spool directory creation in `src/agent/runloop/tool_output/streams_helpers.rs` with shared `ensure_dir_exists_sync`. Replaced Git config file read in `vtcode-core/src/ui/git_config.rs` with shared `read_file_with_context_sync`. Replaced improvements config file reads/writes in `vtcode-core/src/tools/improvements_config.rs` with shared sync helpers (`read_file_with_context_sync`, `write_file_with_context_sync`). Replaced models database load in `vtcode-core/src/config/validator.rs` with shared `read_file_with_context_sync`. Replaced terminal setup wizard config reads in `vtcode-core/src/terminal_setup/wizard.rs` with shared `read_file_with_context_sync`. Replaced temporary edited-file reads in `vtcode-core/src/tools/terminal_app.rs` with shared `read_file_with_context_sync`. Replaced plugin manifest reads in `vtcode-core/src/tools/plugins/mod.rs` with shared async `read_file_with_context`. Replaced terminal config-writer parent-directory creation in `vtcode-core/src/terminal_setup/config_writer.rs` with shared `ensure_dir_exists_sync`. Replaced terminal backup-manager parent-directory creation in `vtcode-core/src/terminal_setup/backup.rs` with shared `ensure_dir_exists_sync`. Replaced trace-store sync/async directory creation plus trace read/write paths in `vtcode-core/src/trace/store.rs` with shared `vtcode_core::utils::file_utils` helpers (`ensure_dir_exists_sync`, `ensure_dir_exists`, `read_file_with_context_sync`, `read_file_with_context`, `write_file_with_context_sync`, `write_file_with_context`). Replaced marketplace settings file read/write + parent-directory creation in `vtcode-core/src/marketplace/config.rs` with shared async helpers (`read_file_with_context`, `write_file_with_context`). Replaced skills lockfile read/write + directory creation in `vtcode-core/src/skills/versioning.rs` with shared sync helpers (`read_file_with_context_sync`, `write_file_with_context_sync`, `ensure_dir_exists_sync`). Replaced theme config file read in `vtcode-core/src/ui/theme_config.rs` with shared `read_file_with_context_sync`. Replaced tool-justification approval-pattern cache read/write + cache-directory creation in `vtcode-core/src/tools/registry/justification.rs` with shared sync helpers (`read_file_with_context_sync`, `write_file_with_context_sync`, `ensure_dir_exists_sync`). Replaced permission-audit directory creation in `vtcode-core/src/audit/permission_log.rs` with shared `ensure_dir_exists_sync`. Replaced session UI config load/save file I/O in `vtcode-core/src/ui/tui/session/config.rs` with shared sync helpers (`read_file_with_context_sync`, `write_file_with_context_sync`). Replaced skills-index generation output write in `src/cli/skills_index.rs` with shared async `write_file_with_context`. Replaced model-cache read/write and parent-directory creation paths in `vtcode-core/src/models_manager/cache.rs` with shared JSON helpers (`read_json_file`, `read_json_file_sync`, `write_json_file`, `write_json_file_sync`) while preserving `NotFound => None` behavior. Continue audit for error handling + config reading duplication. |
| TD-003 | Features       | Session log export feature incomplete. Users cannot export conversation history in a portable format. | P2 | resolved | 2026-02-15 | `/share-log` now supports portable JSON and Markdown exports (`/share-log [json|markdown|md]`, alias `/export-log`) and writes timestamped files in workspace root. |
| TD-004 | Features       | Agent teams implementation is experimental and incomplete. `docs/agent-teams.md` documents the API but implementation gaps remain (teammate lifecycle, error recovery). | P2 | open | 2026-02-15 | Stabilize core team coordination. See `docs/agent-teams.md`. |
| TD-005 | TUI            | Large event handler modules in `src/`. Some files likely exceed 500-line invariant. Hard for agents to navigate. | P2 | in-progress | 2026-02-15 | Began module extraction by moving slash-command help/usage rendering into `src/agent/runloop/slash_commands/rendering.rs`, custom prompt/slash-command handling into `src/agent/runloop/slash_commands/custom.rs`, shared parsing helpers into `src/agent/runloop/slash_commands/parsing.rs`, `/agents` + `/team` command parsing into `src/agent/runloop/slash_commands/team_agent.rs`, `/mcp` + `/add-dir` command parsing into `src/agent/runloop/slash_commands/management.rs`, and flow/state commands (`/sessions`, `/rewind`, `/analyze`, `/plan`, `/agent`, `/mode`, `/login`, `/logout`, `/auth`) into `src/agent/runloop/slash_commands/flow.rs`. `src/agent/runloop/slash_commands.rs` is now 486 lines. Continued extraction in unified slash handlers by moving OAuth handlers to `src/agent/runloop/unified/turn/session/slash_commands/oauth.rs`, session-log export handlers to `src/agent/runloop/unified/turn/session/slash_commands/share_log.rs`, team action handling to `src/agent/runloop/unified/turn/session/slash_commands/team.rs`, agent-management handling to `src/agent/runloop/unified/turn/session/slash_commands/agents.rs`, mode-toggle handling (`/plan`, `/agent`, `/mode`) to `src/agent/runloop/unified/turn/session/slash_commands/modes.rs`, app/session launch handling (`/new`, `/docs`, `/edit`, `/git`) to `src/agent/runloop/unified/turn/session/slash_commands/apps.rs`, UI/model-picker handling (`theme`, `palette`, `sessions`, `file browser`, `model picker`) to `src/agent/runloop/unified/turn/session/slash_commands/ui.rs`, MCP action handling to `src/agent/runloop/unified/turn/session/slash_commands/mcp.rs`, workspace init/directory handlers to `src/agent/runloop/unified/turn/session/slash_commands/workspace.rs`, diagnostics/status handlers to `src/agent/runloop/unified/turn/session/slash_commands/diagnostics.rs`, and skills handlers to `src/agent/runloop/unified/turn/session/slash_commands/skills.rs`. Extracted team task lifecycle/assignment handlers into `src/agent/runloop/unified/turn/session/slash_commands/team_tasks.rs`, reducing `src/agent/runloop/unified/turn/session/slash_commands/team.rs` to 381 lines and `handlers.rs` to 435 lines (both under 500). Also split tool-output diff helpers from `src/agent/runloop/tool_output/files.rs` into `src/agent/runloop/tool_output/files_diff.rs` and moved tests to `src/agent/runloop/tool_output/files_tests.rs`, reducing `files.rs` to 444 lines. Split tool-outcome batch execution helpers (`can_parallelize_batch_tool_call`, batch validation/execution, and execute-and-handle pipeline wrappers) from `src/agent/runloop/unified/turn/tool_outcomes/handlers.rs` into `src/agent/runloop/unified/turn/tool_outcomes/handlers_batch.rs`, reducing `handlers.rs` to 449 lines. Split stream-output helper/test surface from `src/agent/runloop/tool_output/streams.rs` into `src/agent/runloop/tool_output/streams_helpers.rs` (code-fence rendering, spooling/tail/ANSI helpers, and stream tests), reducing `streams.rs` to 399 lines. Split MCP overview/provider/tool-refresh handlers from `src/agent/runloop/unified/mcp_support.rs` into `src/agent/runloop/unified/mcp_support_overview.rs`, reducing `mcp_support.rs` to 445 lines. Split startup helper/config/theme validation functions and startup helper tests from `src/startup/mod.rs` into `src/startup/helpers.rs`, reducing `src/startup/mod.rs` to 449 lines. Split command parsing/output normalization helpers and related tests from `src/agent/runloop/tool_output/commands.rs` into `src/agent/runloop/tool_output/commands_processing.rs`, reducing `commands.rs` to 262 lines. Split first-run provider/model/trust prompt-selection helpers from `src/startup/first_run.rs` into `src/startup/first_run_prompts.rs`, reducing `first_run.rs` to 244 lines. Split `/skills` command parsing (and parse tests) from `src/agent/runloop/skills_commands.rs` into `src/agent/runloop/skills_commands_parser.rs`, reducing `skills_commands.rs` to 370 lines. Moved `tool_output` large-output tests from `src/agent/runloop/tool_output/large_output.rs` into `src/agent/runloop/tool_output/large_output_tests.rs`, reducing `large_output.rs` to 442 lines. Moved welcome bootstrap tests from `src/agent/runloop/welcome.rs` into `src/agent/runloop/welcome_tests.rs`, reducing `welcome.rs` to 394 lines. Moved ACP terminal-command parsing tests from `src/acp/zed/agent/tool_config.rs` into `src/acp/zed/agent/tool_config_tests.rs`, reducing `tool_config.rs` to 408 lines. Split ACP tool-registry provider trait + impls from `src/acp/tooling.rs` into `src/acp/tooling_provider.rs`, reducing `tooling.rs` to 493 lines. Split status-line command execution/payload serialization from `src/agent/runloop/unified/status_line.rs` into `src/agent/runloop/unified/status_line_command.rs`, reducing `status_line.rs` to 379 lines. Split CLI marketplace/plugin handlers from `src/cli/mod.rs` into `src/cli/plugin_marketplace.rs`, reducing `src/cli/mod.rs` to 327 lines. Split lifecycle tool-related hook tests from `src/hooks/lifecycle/tests.rs` into `src/hooks/lifecycle/tests/hook_tooling.rs`, reducing `tests.rs` to 300 lines. Split task-completion/teammate-idle lifecycle interpreters from `src/hooks/lifecycle/interpret.rs` into `src/hooks/lifecycle/interpret_events.rs`, reducing `interpret.rs` to 447 lines. Split skills index generation/regeneration handlers from `src/cli/skills.rs` into `src/cli/skills_index.rs`, reducing `skills.rs` to 492 lines. Split lifecycle hook payload builders from `src/hooks/lifecycle/engine.rs` into `src/hooks/lifecycle/engine/payloads.rs`, reducing `engine.rs` to 444 lines. Split tool-pipeline `run_tool_call` tests from `src/agent/runloop/unified/tool_pipeline/tests.rs` into `src/agent/runloop/unified/tool_pipeline/tests/run_tool_call.rs`, reducing `tests.rs` to 305 lines. Split context-manager tests from `src/agent/runloop/unified/context_manager.rs` into `src/agent/runloop/unified/context_manager_tests.rs`, reducing `context_manager.rs` to 325 lines. Split model-picker reasoning/API-key/custom prompt rendering helpers from `src/agent/runloop/model_picker/rendering.rs` into `src/agent/runloop/model_picker/rendering/prompts.rs`, reducing `rendering.rs` to 359 lines. Split CLI entrypoint helper functions (IDE detection, print/stdin prompt composition, tracing initialization) from `src/main.rs` into `src/main_helpers.rs`, reducing `main.rs` to 446 lines. Split ACP local tool execution and file listing/read helpers from `src/acp/zed/agent/tool_execution.rs` into `src/acp/zed/agent/tool_execution_local.rs`, reducing `tool_execution.rs` to 343 lines. Split model-picker state-transition/reasoning/API-key handlers from `src/agent/runloop/model_picker/mod.rs` into `src/agent/runloop/model_picker/state_machine.rs` and moved model-picker tests into `src/agent/runloop/model_picker/tests.rs`, reducing `mod.rs` to 422 lines. Split prompt refinement acceptance heuristics from `src/agent/runloop/prompt.rs` into `src/agent/runloop/prompt_refinement.rs` and moved prompt tests into `src/agent/runloop/prompt_tests.rs`, reducing `prompt.rs` to 469 lines. Split incremental system prompt tests from `src/agent/runloop/unified/incremental_system_prompt.rs` into `src/agent/runloop/unified/incremental_system_prompt_tests.rs`, reducing `incremental_system_prompt.rs` to 453 lines. Continue splitting other oversized modules in `src/`. |
| TD-006 | Security       | Security documentation scattered across 10+ files. | P2 | resolved | 2026-02-15 | Consolidated into `docs/security/` with unified index. |
| TD-007 | Testing        | PTY session management has low test coverage due to inherent difficulty of testing terminal interactions. | P2 | in-progress | 2026-02-15 | Added `tmux` testing pattern in `.agent/workflows/pi-tui-test.md` for automated TUI verification. |
| TD-008 | Testing        | MCP OAuth flow and provider lifecycle lack integration tests. | P2 | in-progress | 2026-02-15 | Added integration tests for provider lifecycle using `tests/fixtures/mock_mcp_server.py` (initialize, execute, shutdown, reinitialize, idempotent shutdown) and CLI OAuth guardrails (`mcp login/logout` currently unsupported). Expand to full OAuth callback-flow coverage when MCP OAuth implementation lands. |
| TD-009 | Documentation  | Tree-sitter language support matrix not documented. Users and agents cannot easily determine which languages are supported. | P3 | resolved | 2026-02-15 | Created `docs/LANGUAGE_SUPPORT.md` with supported languages and feature matrix. |
| TD-010 | Configuration  | Individual config field documentation is partial. Not all `vtcode.toml` fields have descriptions. | P3 | resolved | 2026-02-15 | Added schema-generated field reference: `docs/config/CONFIG_FIELD_REFERENCE.md` (generated via `scripts/generate_config_field_reference.py`, sourced from `vtcode-config` schema). |
| TD-011 | Harness        | Harness documentation review. | P2 | resolved | 2026-02-15 | Full harness review conducted. Quality Score and Tech Debt Tracker updated to reflect current system state. |
| TD-012 | Codebase       | Legacy output patterns in tools may violate the new Agent Legibility invariant. | P2 | resolved | 2026-02-15 | Applied `badlogic-pi-mono` patterns for code quality and git safety. All new docs follow legibility invariant. |
| TD-013 | Codebase       | Structured logging audit. Legacy `println!` may exist in non-TUI crates. | P2 | resolved | 2026-02-15 | Audited crates and replaced `println!`/`eprintln!` with `tracing` macros in `vtcode-core` agent runner and registry modules. |
| TD-014 | Tooling        | Custom lints with remediation not yet implemented in CI. | P2 | resolved | 2026-02-15 | CI now runs custom invariant checks with remediation guidance: `scripts/check_large_files.py` and `scripts/check_markdown_location.py`. |

---

## How to Add a New Item

1. Assign the next sequential ID (`TD-NNN`).
2. Fill in all columns. Description should be specific enough for an agent to act on.
3. Set priority based on impact (see priority levels above).
4. Set status to `open`.
5. Set Last Reviewed to today's date.
6. Add notes with pointers to related docs, exec plans, or code locations.

## How to Resolve an Item

1. Update status to `resolved`.
2. Update Last Reviewed date.
3. Add a note referencing the PR, commit, or exec plan that resolved it.
4. Keep the row in the table for historical reference (do not delete).

## Review Cadence

- **P0 items**: review daily until resolved.
- **P1 items**: review weekly.
- **P2â€“P3 items**: review bi-weekly.
- **All items**: full table review monthly. Archive `resolved` items older than 3 months to a separate section.
