# Cross configuration for VTCode project
# Optimized for cross-compilation of the multi-platform Rust-based terminal coding agent

[build]
# Enable caching for faster builds
xargo = true
# Build in release mode by default for binaries
default-target = "x86_64-unknown-linux-gnu"

# Environment variables needed for cross-compilation
[build.env]
# Allow pkg-config to work during cross-compilation
passthrough = [
    "PKG_CONFIG_ALLOW_CROSS",
    "OPENSSL_DIR",
    "OPENSSL_LIB_DIR", 
    "OPENSSL_INCLUDE_DIR",
    "SDKROOT",
    "VTCODE_SKIP_AUTO_CROSS",
    "VCPKG_ROOT",
    "VCPKG_ROOT_STATUS", 
    "OPENSSL_STATIC",
]

# Target-specific configurations - these will use Docker by default
# To build without Docker, use `cargo build` directly or set CROSS_CONTAINER_ENGINE=

# Target-specific configurations
[target.x86_64-apple-darwin]
image = "ghcr.io/cross-rs/x86_64-apple-darwin:latest"
pre-build = [
    "export SDKROOT=$(xcrun --sdk macosx --show-sdk-path 2>/dev/null || echo '')",
    "export PKG_CONFIG_ALLOW_CROSS=1"
]

[target.aarch64-apple-darwin] 
image = "ghcr.io/cross-rs/aarch64-apple-darwin:latest"
pre-build = [
    "export SDKROOT=$(xcrun --sdk macosx --show-sdk-path 2>/dev/null || echo '')",
    "export PKG_CONFIG_ALLOW_CROSS=1"
]

[target.x86_64-unknown-linux-gnu]
image = "ghcr.io/cross-rs/x86_64-unknown-linux-gnu:latest"
pre-build = [
    "apt-get update && apt-get install -y pkg-config libssl-dev",
    "export PKG_CONFIG_ALLOW_CROSS=1"
]

[target.aarch64-unknown-linux-gnu]
image = "ghcr.io/cross-rs/aarch64-unknown-linux-gnu:latest"
pre-build = [
    "apt-get update && apt-get install -y pkg-config libssl-dev",
    "export PKG_CONFIG_ALLOW_CROSS=1"
]

[target.x86_64-pc-windows-msvc]
image = "ghcr.io/cross-rs/x86_64-pc-windows-msvc:latest"
pre-build = [
    "vcpkg install openssl:x64-windows",
    "export PKG_CONFIG_ALLOW_CROSS=1"
]

[target.aarch64-pc-windows-msvc]
image = "ghcr.io/cross-rs/aarch64-pc-windows-msvc:latest"
pre-build = [
    "vcpkg install openssl:x64-windows",
    "export PKG_CONFIG_ALLOW_CROSS=1"
]